<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>machine.ml &mdash; Coverage report</title>
    <meta name="description" content="100.00% coverage in lib/riscv/machine.ml">
    <link rel="stylesheet" href="../../coverage.css"/>
    <script src="../../highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body>
    <div id="header">
      <h1>
        <a href="../../index.html">
          <span class="dirname">lib/riscv/</span>machine.ml
        </a>
      </h1>
      <h2>100.00%</h2>
    </div>
    <div id="navbar">
    </div>
    <div id="report">
      <div id="lines-layer">
        <pre>
<a id="L1"></a><span > </span>
<a id="L2"></a><span > </span>
<a id="L3"></a><span > </span>
<a id="L4"></a><span > </span>
<a id="L5"></a><span > </span>
<a id="L6"></a><span > </span>
<a id="L7"></a><span > </span>
<a id="L8"></a><span > </span>
<a id="L9"></a><span > </span>
<a id="L10"></a><span > </span>
<a id="L11"></a><span > </span>
<a id="L12"></a><span > </span>
<a id="L13"></a><span > </span>
<a id="L14"></a><span > </span>
<a id="L15"></a><span > </span>
<a id="L16"></a><span > </span>
<a id="L17"></a><span > </span>
<a id="L18"></a><span > </span>
<a id="L19"></a><span > </span>
<a id="L20"></a><span class="visited"> </span>
<a id="L21"></a><span > </span>
<a id="L22"></a><span class="visited"> </span>
<a id="L23"></a><span class="visited"> </span>
<a id="L24"></a><span class="visited"> </span>
<a id="L25"></a><span class="visited"> </span>
<a id="L26"></a><span class="visited"> </span>
<a id="L27"></a><span class="visited"> </span>
<a id="L28"></a><span class="visited"> </span>
<a id="L29"></a><span > </span>
<a id="L30"></a><span > </span>
<a id="L31"></a><span > </span>
<a id="L32"></a><span > </span>
<a id="L33"></a><span > </span>
<a id="L34"></a><span > </span>
<a id="L35"></a><span > </span>
<a id="L36"></a><span > </span>
<a id="L37"></a><span > </span>
<a id="L38"></a><span > </span>
<a id="L39"></a><span > </span>
<a id="L40"></a><span > </span>
<a id="L41"></a><span > </span>
<a id="L42"></a><span > </span>
<a id="L43"></a><span > </span>
<a id="L44"></a><span > </span>
<a id="L45"></a><span > </span>
<a id="L46"></a><span > </span>
<a id="L47"></a><span > </span>
<a id="L48"></a><span > </span>
<a id="L49"></a><span > </span>
<a id="L50"></a><span > </span>
<a id="L51"></a><span > </span>
<a id="L52"></a><span > </span>
<a id="L53"></a><span > </span>
<a id="L54"></a><span > </span>
<a id="L55"></a><span > </span>
<a id="L56"></a><span > </span>
<a id="L57"></a><span > </span>
<a id="L58"></a><span > </span>
<a id="L59"></a><span > </span>
<a id="L60"></a><span > </span>
<a id="L61"></a><span > </span>
<a id="L62"></a><span > </span>
<a id="L63"></a><span > </span>
<a id="L64"></a><span > </span>
<a id="L65"></a><span > </span>
<a id="L66"></a><span > </span>
<a id="L67"></a><span class="visited"> </span>
<a id="L68"></a><span > </span>
<a id="L69"></a><span class="visited"> </span>
<a id="L70"></a><span class="visited"> </span>
<a id="L71"></a><span class="visited"> </span>
<a id="L72"></a><span class="visited"> </span>
<a id="L73"></a><span class="visited"> </span>
<a id="L74"></a><span class="visited"> </span>
<a id="L75"></a><span class="visited"> </span>
<a id="L76"></a><span class="visited"> </span>
<a id="L77"></a><span class="visited"> </span>
<a id="L78"></a><span class="visited"> </span>
<a id="L79"></a><span class="visited"> </span>
<a id="L80"></a><span class="visited"> </span>
<a id="L81"></a><span class="visited"> </span>
<a id="L82"></a><span class="visited"> </span>
<a id="L83"></a><span class="visited"> </span>
<a id="L84"></a><span class="visited"> </span>
<a id="L85"></a><span class="visited"> </span>
<a id="L86"></a><span class="visited"> </span>
<a id="L87"></a><span class="visited"> </span>
<a id="L88"></a><span class="visited"> </span>
<a id="L89"></a><span class="visited"> </span>
<a id="L90"></a><span class="visited"> </span>
<a id="L91"></a><span class="visited"> </span>
<a id="L92"></a><span class="visited"> </span>
<a id="L93"></a><span class="visited"> </span>
<a id="L94"></a><span class="visited"> </span>
<a id="L95"></a><span class="visited"> </span>
<a id="L96"></a><span class="visited"> </span>
<a id="L97"></a><span class="visited"> </span>
<a id="L98"></a><span class="visited"> </span>
<a id="L99"></a><span > </span>
<a id="L100"></a><span > </span>
<a id="L101"></a><span class="visited"> </span>
<a id="L102"></a><span class="visited"> </span>
<a id="L103"></a><span class="visited"> </span>
<a id="L104"></a><span class="visited"> </span>
<a id="L105"></a><span class="visited"> </span>
<a id="L106"></a><span class="visited"> </span>
<a id="L107"></a><span class="visited"> </span>
<a id="L108"></a><span class="visited"> </span>
<a id="L109"></a><span class="visited"> </span>
<a id="L110"></a><span class="visited"> </span>
<a id="L111"></a><span class="visited"> </span>
<a id="L112"></a><span class="visited"> </span>
<a id="L113"></a><span class="visited"> </span>
<a id="L114"></a><span class="visited"> </span>
<a id="L115"></a><span class="visited"> </span>
<a id="L116"></a><span class="visited"> </span>
<a id="L117"></a><span class="visited"> </span>
<a id="L118"></a><span class="visited"> </span>
<a id="L119"></a><span class="visited"> </span>
<a id="L120"></a><span class="visited"> </span>
<a id="L121"></a><span class="visited"> </span>
<a id="L122"></a><span class="visited"> </span>
<a id="L123"></a><span class="visited"> </span>
<a id="L124"></a><span > </span>
<a id="L125"></a><span class="visited"> </span>
<a id="L126"></a><span > </span>
<a id="L127"></a><span class="visited"> </span>
<a id="L128"></a><span class="visited"> </span>
<a id="L129"></a><span class="visited"> </span>
<a id="L130"></a><span class="visited"> </span>
<a id="L131"></a><span > </span>
<a id="L132"></a><span > </span>
<a id="L133"></a><span class="visited"> </span>
<a id="L134"></a><span > </span>
<a id="L135"></a><span class="visited"> </span>
<a id="L136"></a><span > </span>
<a id="L137"></a><span > </span>
<a id="L138"></a><span class="visited"> </span>
<a id="L139"></a><span class="visited"> </span>
<a id="L140"></a><span class="visited"> </span>
<a id="L141"></a><span class="visited"> </span>
<a id="L142"></a><span class="visited"> </span>
<a id="L143"></a><span class="visited"> </span>
<a id="L144"></a><span class="visited"> </span>
<a id="L145"></a><span class="visited"> </span>
<a id="L146"></a><span class="visited"> </span>
<a id="L147"></a><span class="visited"> </span>
<a id="L148"></a><span class="visited"> </span>
<a id="L149"></a><span class="visited"> </span>
<a id="L150"></a><span class="visited"> </span>
<a id="L151"></a><span class="visited"> </span>
<a id="L152"></a><span class="visited"> </span>
<a id="L153"></a><span class="visited"> </span>
<a id="L154"></a><span class="visited"> </span>
<a id="L155"></a><span class="visited"> </span>
<a id="L156"></a><span class="visited"> </span>
<a id="L157"></a><span class="visited"> </span>
<a id="L158"></a><span class="visited"> </span>
<a id="L159"></a><span class="visited"> </span>
<a id="L160"></a><span class="visited"> </span>
<a id="L161"></a><span > </span>
<a id="L162"></a><span class="visited"> </span>
<a id="L163"></a><span > </span>
<a id="L164"></a><span class="visited"> </span>
<a id="L165"></a><span class="visited"> </span>
<a id="L166"></a><span class="visited"> </span>
<a id="L167"></a><span class="visited"> </span>
<a id="L168"></a><span > </span>
<a id="L169"></a><span > </span>
<a id="L170"></a><span > </span>
<a id="L171"></a><span class="visited"> </span>
<a id="L172"></a><span > </span>
<a id="L173"></a><span > </span>
<a id="L174"></a><span > </span>
<a id="L175"></a><span > </span>
<a id="L176"></a><span > </span>
<a id="L177"></a><span > </span>
<a id="L178"></a><span > </span>
<a id="L179"></a><span > </span>
<a id="L180"></a><span > </span>
<a id="L181"></a><span > </span>
<a id="L182"></a><span > </span>
<a id="L183"></a><span > </span>
<a id="L184"></a><span > </span>
<a id="L185"></a><span > </span>
<a id="L186"></a><span > </span>
<a id="L187"></a><span > </span>
<a id="L188"></a><span > </span>
<a id="L189"></a><span > </span>
<a id="L190"></a><span > </span>
<a id="L191"></a><span > </span>
<a id="L192"></a><span > </span>
<a id="L193"></a><span > </span>
<a id="L194"></a><span > </span>
<a id="L195"></a><span > </span>
<a id="L196"></a><span > </span>
<a id="L197"></a><span > </span>
<a id="L198"></a><span > </span>
<a id="L199"></a><span > </span>
<a id="L200"></a><span > </span>
<a id="L201"></a><span > </span>
<a id="L202"></a><span > </span>
<a id="L203"></a><span class="visited"> </span>
<a id="L204"></a><span > </span>
</pre>
      </div>
      <div id="text-layer">
        <pre id="line-numbers">
<a href="#L1">  1</a>
<a href="#L2">  2</a>
<a href="#L3">  3</a>
<a href="#L4">  4</a>
<a href="#L5">  5</a>
<a href="#L6">  6</a>
<a href="#L7">  7</a>
<a href="#L8">  8</a>
<a href="#L9">  9</a>
<a href="#L10"> 10</a>
<a href="#L11"> 11</a>
<a href="#L12"> 12</a>
<a href="#L13"> 13</a>
<a href="#L14"> 14</a>
<a href="#L15"> 15</a>
<a href="#L16"> 16</a>
<a href="#L17"> 17</a>
<a href="#L18"> 18</a>
<a href="#L19"> 19</a>
<a href="#L20"> 20</a>
<a href="#L21"> 21</a>
<a href="#L22"> 22</a>
<a href="#L23"> 23</a>
<a href="#L24"> 24</a>
<a href="#L25"> 25</a>
<a href="#L26"> 26</a>
<a href="#L27"> 27</a>
<a href="#L28"> 28</a>
<a href="#L29"> 29</a>
<a href="#L30"> 30</a>
<a href="#L31"> 31</a>
<a href="#L32"> 32</a>
<a href="#L33"> 33</a>
<a href="#L34"> 34</a>
<a href="#L35"> 35</a>
<a href="#L36"> 36</a>
<a href="#L37"> 37</a>
<a href="#L38"> 38</a>
<a href="#L39"> 39</a>
<a href="#L40"> 40</a>
<a href="#L41"> 41</a>
<a href="#L42"> 42</a>
<a href="#L43"> 43</a>
<a href="#L44"> 44</a>
<a href="#L45"> 45</a>
<a href="#L46"> 46</a>
<a href="#L47"> 47</a>
<a href="#L48"> 48</a>
<a href="#L49"> 49</a>
<a href="#L50"> 50</a>
<a href="#L51"> 51</a>
<a href="#L52"> 52</a>
<a href="#L53"> 53</a>
<a href="#L54"> 54</a>
<a href="#L55"> 55</a>
<a href="#L56"> 56</a>
<a href="#L57"> 57</a>
<a href="#L58"> 58</a>
<a href="#L59"> 59</a>
<a href="#L60"> 60</a>
<a href="#L61"> 61</a>
<a href="#L62"> 62</a>
<a href="#L63"> 63</a>
<a href="#L64"> 64</a>
<a href="#L65"> 65</a>
<a href="#L66"> 66</a>
<a href="#L67"> 67</a>
<a href="#L68"> 68</a>
<a href="#L69"> 69</a>
<a href="#L70"> 70</a>
<a href="#L71"> 71</a>
<a href="#L72"> 72</a>
<a href="#L73"> 73</a>
<a href="#L74"> 74</a>
<a href="#L75"> 75</a>
<a href="#L76"> 76</a>
<a href="#L77"> 77</a>
<a href="#L78"> 78</a>
<a href="#L79"> 79</a>
<a href="#L80"> 80</a>
<a href="#L81"> 81</a>
<a href="#L82"> 82</a>
<a href="#L83"> 83</a>
<a href="#L84"> 84</a>
<a href="#L85"> 85</a>
<a href="#L86"> 86</a>
<a href="#L87"> 87</a>
<a href="#L88"> 88</a>
<a href="#L89"> 89</a>
<a href="#L90"> 90</a>
<a href="#L91"> 91</a>
<a href="#L92"> 92</a>
<a href="#L93"> 93</a>
<a href="#L94"> 94</a>
<a href="#L95"> 95</a>
<a href="#L96"> 96</a>
<a href="#L97"> 97</a>
<a href="#L98"> 98</a>
<a href="#L99"> 99</a>
<a href="#L100">100</a>
<a href="#L101">101</a>
<a href="#L102">102</a>
<a href="#L103">103</a>
<a href="#L104">104</a>
<a href="#L105">105</a>
<a href="#L106">106</a>
<a href="#L107">107</a>
<a href="#L108">108</a>
<a href="#L109">109</a>
<a href="#L110">110</a>
<a href="#L111">111</a>
<a href="#L112">112</a>
<a href="#L113">113</a>
<a href="#L114">114</a>
<a href="#L115">115</a>
<a href="#L116">116</a>
<a href="#L117">117</a>
<a href="#L118">118</a>
<a href="#L119">119</a>
<a href="#L120">120</a>
<a href="#L121">121</a>
<a href="#L122">122</a>
<a href="#L123">123</a>
<a href="#L124">124</a>
<a href="#L125">125</a>
<a href="#L126">126</a>
<a href="#L127">127</a>
<a href="#L128">128</a>
<a href="#L129">129</a>
<a href="#L130">130</a>
<a href="#L131">131</a>
<a href="#L132">132</a>
<a href="#L133">133</a>
<a href="#L134">134</a>
<a href="#L135">135</a>
<a href="#L136">136</a>
<a href="#L137">137</a>
<a href="#L138">138</a>
<a href="#L139">139</a>
<a href="#L140">140</a>
<a href="#L141">141</a>
<a href="#L142">142</a>
<a href="#L143">143</a>
<a href="#L144">144</a>
<a href="#L145">145</a>
<a href="#L146">146</a>
<a href="#L147">147</a>
<a href="#L148">148</a>
<a href="#L149">149</a>
<a href="#L150">150</a>
<a href="#L151">151</a>
<a href="#L152">152</a>
<a href="#L153">153</a>
<a href="#L154">154</a>
<a href="#L155">155</a>
<a href="#L156">156</a>
<a href="#L157">157</a>
<a href="#L158">158</a>
<a href="#L159">159</a>
<a href="#L160">160</a>
<a href="#L161">161</a>
<a href="#L162">162</a>
<a href="#L163">163</a>
<a href="#L164">164</a>
<a href="#L165">165</a>
<a href="#L166">166</a>
<a href="#L167">167</a>
<a href="#L168">168</a>
<a href="#L169">169</a>
<a href="#L170">170</a>
<a href="#L171">171</a>
<a href="#L172">172</a>
<a href="#L173">173</a>
<a href="#L174">174</a>
<a href="#L175">175</a>
<a href="#L176">176</a>
<a href="#L177">177</a>
<a href="#L178">178</a>
<a href="#L179">179</a>
<a href="#L180">180</a>
<a href="#L181">181</a>
<a href="#L182">182</a>
<a href="#L183">183</a>
<a href="#L184">184</a>
<a href="#L185">185</a>
<a href="#L186">186</a>
<a href="#L187">187</a>
<a href="#L188">188</a>
<a href="#L189">189</a>
<a href="#L190">190</a>
<a href="#L191">191</a>
<a href="#L192">192</a>
<a href="#L193">193</a>
<a href="#L194">194</a>
<a href="#L195">195</a>
<a href="#L196">196</a>
<a href="#L197">197</a>
<a href="#L198">198</a>
<a href="#L199">199</a>
<a href="#L200">200</a>
<a href="#L201">201</a>
<a href="#L202">202</a>
<a href="#L203">203</a>
<a href="#L204">204</a>
</pre>
<pre><code class="ocaml">[@@@ocaml.text "/*"]

(** Copyright 2025-2026, Gleb Nasretdinov, Ilhom Kombaev *)

(** SPDX-License-Identifier: LGPL-3.0-or-later *)

[@@@ocaml.text "/*"]

type reg =
  | Zero
  | Ra
  | Sp
  | A of int
  | S of int
  | T of int

let fp = S 0

let pp_reg fmt =
  <span data-count="3216">l</span>et open Format in
  function
  | <span data-count="16">Z</span>ero -&gt; fprintf fmt "zero"
  | <span data-count="75">R</span>a -&gt; fprintf fmt "ra"
  | <span data-count="1075">S</span>p -&gt; fprintf fmt "sp"
  | <span data-count="261">A</span> n -&gt; fprintf fmt "a%d" n
  | <span data-count="529">S</span> n when n = 0 -&gt; <span data-count="527">f</span>printf fmt "fp"
  | <span data-count="2">S</span> n -&gt; fprintf fmt "s%d" n
  | <span data-count="1260">T</span> n -&gt; fprintf fmt "t%d" n
;;

type offset = int

type instr =
  | Addi of reg * reg * int
  | Add of reg * reg * reg
  | Sub of reg * reg * reg
  | Mul of reg * reg * reg
  | Div of reg * reg * reg
  | Li of reg * int
  | Ld of reg * offset * reg
  | La of reg * string
  | Slt of reg * reg * reg
  | Seqz of reg * reg
  | Snez of reg * reg
  | Mv of reg * reg
  | Sd of reg * offset * reg
  | Xori of reg * reg * int
  | Xor of reg * reg * reg
  | Andi of reg * reg * int
  | And of reg * reg * reg
  | Ori of reg * reg * int
  | Or of reg * reg * reg
  | Beq of reg * reg * string
  | Ble of reg * reg * string
  | J of string
  | Jalr of reg * reg * int
  | Ecall
  | Call of string
  | Ret
  | Label of string
  | Directive of string
  | Comment of string
  (* Global 8 byte variable *)
  | DWord of string

let pp_instr fmt =
  <span data-count="2717">l</span>et open Format in
  function
  | <span data-count="340">A</span>ddi (rd, rs, n) -&gt; fprintf fmt "addi %a, %a, %d" pp_reg rd pp_reg rs n
  | <span data-count="20">A</span>dd (rd, rs1, rs2) -&gt; fprintf fmt "add %a, %a, %a" pp_reg rd pp_reg rs1 pp_reg rs2
  | <span data-count="20">S</span>ub (rd, rs1, rs2) -&gt; fprintf fmt "sub %a, %a, %a" pp_reg rd pp_reg rs1 pp_reg rs2
  | <span data-count="4">M</span>ul (rd, rs1, rs2) -&gt; fprintf fmt "mul %a, %a, %a" pp_reg rd pp_reg rs1 pp_reg rs2
  | <span data-count="2">D</span>iv (rd, rs1, rs2) -&gt; fprintf fmt "div %a, %a, %a" pp_reg rd pp_reg rs1 pp_reg rs2
  | <span data-count="254">L</span>i (rd, n) -&gt; fprintf fmt "li %a, %d" pp_reg rd n
  | <span data-count="316">L</span>d (rd, offset, rs) -&gt; fprintf fmt "ld %a, %d(%a)" pp_reg rd offset pp_reg rs
  | <span data-count="67">L</span>a (rd, label) -&gt; fprintf fmt "la %a, %s" pp_reg rd label
  | <span data-count="8">S</span>lt (rd, rs1, rs2) -&gt; fprintf fmt "slt %a, %a, %a" pp_reg rd pp_reg rs1 pp_reg rs2
  | <span data-count="10">S</span>eqz (rd, rs) -&gt; fprintf fmt "seqz %a, %a" pp_reg rd pp_reg rs
  | <span data-count="2">S</span>nez (rd, rs) -&gt; fprintf fmt "snez %a, %a" pp_reg rd pp_reg rs
  | <span data-count="141">M</span>v (rd, rs) -&gt; fprintf fmt "mv %a, %a" pp_reg rd pp_reg rs
  | <span data-count="525">S</span>d (rs1, offset, rs2) -&gt; fprintf fmt "sd %a, %d(%a)" pp_reg rs1 offset pp_reg rs2
  | <span data-count="4">X</span>ori (rd, rs, n) -&gt; fprintf fmt "xori %a, %a, %d" pp_reg rd pp_reg rs n
  | <span data-count="1">X</span>or (rd, rs1, rs2) -&gt; fprintf fmt "xor %a, %a, %a" pp_reg rd pp_reg rs1 pp_reg rs2
  | <span data-count="1">A</span>ndi (rd, rs, n) -&gt; fprintf fmt "andi %a, %a, %d" pp_reg rd pp_reg rs n
  | <span data-count="2">A</span>nd (rd, rs1, rs2) -&gt; fprintf fmt "and %a, %a, %a" pp_reg rd pp_reg rs1 pp_reg rs2
  | <span data-count="1">O</span>ri (rd, rs, n) -&gt; fprintf fmt "ori %a, %a, %d" pp_reg rd pp_reg rs n
  | <span data-count="2">O</span>r (rd, rs1, rs2) -&gt; fprintf fmt "or %a, %a, %a" pp_reg rd pp_reg rs1 pp_reg rs2
  | <span data-count="17">B</span>eq (rs1, rs2, label) -&gt; fprintf fmt "beq %a, %a, %s" pp_reg rs1 pp_reg rs2 label
  | <span data-count="1">B</span>le (rs1, rs2, label) -&gt; fprintf fmt "ble %a, %a, %s" pp_reg rs1 pp_reg rs2 label
  | <span data-count="17">J</span> label -&gt; fprintf fmt "j %s" label
  | <span data-count="1">J</span>alr (rs1, rs2, imm) -&gt; fprintf fmt "jalr %a, %a, %d" pp_reg rs1 pp_reg rs2 imm
  | <span data-count="25">E</span>call -&gt; fprintf fmt "ecall"
  | <span data-count="161">C</span>all symbol -&gt; fprintf fmt "call %s" symbol
  | <span data-count="38">R</span>et -&gt; fprintf fmt "ret"
  | <span data-count="94">L</span>abel label -&gt; fprintf fmt "%s:" label
  | <span data-count="109">D</span>irective name -&gt; fprintf fmt "%s" name
  | <span data-count="499">C</span>omment comment -&gt; fprintf fmt "# %s" comment
  | <span data-count="35">D</span>Word name -&gt; fprintf fmt "%s: .dword 0" name
;;

let addi r1 r2 n = <span data-count="340">A</span>ddi (r1, r2, n)
let add r1 r2 r3 = <span data-count="20">A</span>dd (r1, r2, r3)
let sub r1 r2 r3 = <span data-count="20">S</span>ub (r1, r2, r3)
let mul r1 r2 r3 = <span data-count="4">M</span>ul (r1, r2, r3)
let div r1 r2 r3 = <span data-count="2">D</span>iv (r1, r2, r3)
let li r n = <span data-count="254">L</span>i (r, n)
let ld r off base = <span data-count="316">L</span>d (r, off, base)
let la r label = <span data-count="67">L</span>a (r, label)
let slt r1 r2 r3 = <span data-count="8">S</span>lt (r1, r2, r3)
let seqz r1 r2 = <span data-count="10">S</span>eqz (r1, r2)
let snez r1 r2 = <span data-count="2">S</span>nez (r1, r2)
let mv r1 r2 = <span data-count="141">M</span>v (r1, r2)
let sd r1 off base = <span data-count="525">S</span>d (r1, off, base)
let xori r1 r2 n = <span data-count="4">X</span>ori (r1, r2, n)
let xor r1 r2 r3 = <span data-count="1">X</span>or (r1, r2, r3)
let andi r1 r2 n = <span data-count="1">A</span>ndi (r1, r2, n)
let and_ r1 r2 r3 = <span data-count="2">A</span>nd (r1, r2, r3)
let ori r1 r2 n = <span data-count="1">O</span>ri (r1, r2, n)
let or_ r1 r2 r3 = <span data-count="2">O</span>r (r1, r2, r3)
let beq r1 r2 label = <span data-count="17">B</span>eq (r1, r2, label)
let ble r1 r2 label = <span data-count="1">B</span>le (r1, r2, label)
let j label = <span data-count="17">J</span> label
let jalr rd rs1 imm = <span data-count="1">J</span>alr (rd, rs1, imm)
let ecall = Ecall
let call symbol = <span data-count="161">C</span>all symbol
let ret = Ret
let label l = <span data-count="94">L</span>abel l
let directive l = <span data-count="86">D</span>irective l
let comment c = <span data-count="499">C</span>omment c
let dword name = <span data-count="1">D</span>Word name

let%expect_test "Print all regs and instructions" =
  <span data-count="1">l</span>et open Format in
  let print_program (instr : instr list) : unit =
    <span data-count="1">p</span>p_print_list ~pp_sep:(fun fmt () -&gt; <span data-count="29">f</span>printf fmt "\n") pp_instr std_formatter instr
  in
  let program =
    [ add<span data-count="1">i</span> (A 0) (A 2) 2
    ; ad<span data-count="1">d</span> (T 0) (T 1) (T 2)
    ; su<span data-count="1">b</span> (S 0) (S 1) (A 0)
    ; mu<span data-count="1">l</span> (A 1) (A 2) (A 3)
    ; di<span data-count="1">v</span> (A 4) (A 5) (A 6)
    ; l<span data-count="1">i</span> (A 7) 42
    ; l<span data-count="1">d</span> (A 0) 8 Sp
    ; l<span data-count="1">a</span> (A 1) "msg"
    ; sl<span data-count="1">t</span> (T 3) (T 4) (T 5)
    ; seq<span data-count="1">z</span> (A 2) (A 3)
    ; sne<span data-count="1">z</span> (A 4) (A 5)
    ; m<span data-count="1">v</span> (A 6) (A 7)
    ; s<span data-count="1">d</span> (A 0) 16 Sp
    ; xor<span data-count="1">i</span> (A 1) (A 2) 5
    ; xo<span data-count="1">r</span> (A 3) (A 4) (A 5)
    ; and<span data-count="1">i</span> (A 6) (A 7) 7
    ; and<span data-count="1">_</span> (A 0) (A 1) (A 2)
    ; or<span data-count="1">i</span> (A 3) (A 4) 9
    ; or<span data-count="1">_</span> (S 0) (S 1) (A 0)
    ; be<span data-count="1">q</span> (A 0) (A 1) "label1"
    ; bl<span data-count="1">e</span> (A 2) (A 3) "label2"
    ; <span data-count="1">j</span> "main"
    ; jal<span data-count="1">r</span> Ra Sp 0
    ; ecall
    ; cal<span data-count="1">l</span> "print_int"
    ; ret
    ; labe<span data-count="1">l</span> "loop"
    ; directiv<span data-count="1">e</span> ".text"
    ; commen<span data-count="1">t</span> "done"
    ; dwor<span data-count="1">d</span> "val"
    ]
  in
  print_program program;
  <span data-count="1">[</span>%expect
    {|
  addi a0, a2, 2
  add t0, t1, t2
  sub fp, s1, a0
  mul a1, a2, a3
  div a4, a5, a6
  li a7, 42
  ld a0, 8(sp)
  la a1, msg
  slt t3, t4, t5
  seqz a2, a3
  snez a4, a5
  mv a6, a7
  sd a0, 16(sp)
  xori a1, a2, 5
  xor a3, a4, a5
  andi a6, a7, 7
  and a0, a1, a2
  ori a3, a4, 9
  or fp, s1, a0
  beq a0, a1, label1
  ble a2, a3, label2
  j main
  jalr ra, sp, 0
  ecall
  call print_int
  ret
  loop:
  .text
  # done
  val: .dword 0
    |}<span data-count="221">]</span>
;;
</code></pre>
      </div>
    </div>
    <script src="../../coverage.js"></script>
  </body>
</html>
